datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")   // <— только так, без русских имён переменных
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
}

model LegacyUser {
  id        Int      @id @default(autoincrement())
  tgId      BigInt   @unique
  firstName String?
  lastName  String?
  role      String   @default("PROMOTER")
  createdAt DateTime @default(now())
  sales     Sale[]

  @@map("User")
}

model LegacyRegion {
  id     Int           @id @default(autoincrement())
  name   String        @unique
  stores LegacyStore[]

  @@map("Region")
}

model LegacyStore {
  id       Int          @id @default(autoincrement())
  name     String
  address  String?
  regionId Int
  region   LegacyRegion @relation(fields: [regionId], references: [id])
  stocks   Stock[]
  sales    Sale[]

  @@map("Store")
}

model SKU {
  id     Int     @id @default(autoincrement())
  code   String  @unique
  name   String
  unit   String  @default("pcs")
  stocks Stock[]
  sales  Sale[]
}

model Stock {
  storeId Int
  skuId   Int
  qty     Decimal @default(0)
  store   LegacyStore @relation(fields: [storeId], references: [id])
  sku     SKU         @relation(fields: [skuId], references: [id])

  @@id([storeId, skuId])
}

model Sale {
  id        Int      @id @default(autoincrement())
  userId    Int
  storeId   Int
  skuId     Int
  qty       Decimal
  price     Decimal?
  createdAt DateTime @default(now())

  user  LegacyUser  @relation(fields: [userId], references: [id])
  store LegacyStore @relation(fields: [storeId], references: [id])
  sku   SKU         @relation(fields: [skuId], references: [id])
}

model Role {
  id        String   @id @default(cuid())
  name      String   @unique
  users     User[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Network {
  id        String   @id @default(cuid())
  name      String   @unique
  regions   Region[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Region {
  id         String   @id @default(cuid())
  name       String
  networkId  String
  network    Network  @relation(fields: [networkId], references: [id])
  offices    Office[]
  supervisors User[]   @relation("RegionSupervisors")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("OrgRegion")
}

model Office {
  id        String   @id @default(cuid())
  name      String
  regionId  String
  region    Region   @relation(fields: [regionId], references: [id])
  stores    Store[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("OrgOffice")
}

model Store {
  id        String   @id @default(cuid())
  name      String
  address   String?
  city      String?
  officeId  String
  office    Office   @relation(fields: [officeId], references: [id])
  promoters User[]   @relation("StorePromoters")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("OrgStore")
}

model User {
  id           String   @id @default(cuid())
  telegramId   String?  @unique
  fullName     String?
  phone        String?
  email        String?
  roleId       String?
  role         Role?    @relation(fields: [roleId], references: [id])
  regionId     String?
  region       Region?  @relation("RegionSupervisors", fields: [regionId], references: [id])
  storeId      String?
  store        Store?   @relation("StorePromoters", fields: [storeId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("OrgUser")
}
